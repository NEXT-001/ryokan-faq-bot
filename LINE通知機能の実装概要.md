# LINE通知機能の実装概要

## 実装した変更

### 1. チャットサービスの修正 (`chat_service.py`)

- 類似度が低い場合（0.4未満）にLINE通知を送信する機能を追加
- ユーザー情報（部屋番号など）を`get_response`関数に渡せるように拡張
- エラー発生時にもLINE通知を送信するように修正

### 2. LINE設定ページの追加 (`line_settings.py`)

- 管理者がLINEの通知設定を行うためのUIを実装
- 以下の設定が可能に:
  - LINEチャネルアクセストークン
  - LINEチャネルシークレット
  - LINE通知先ユーザーID
  - 通知送信の類似度しきい値
- テスト通知を送信する機能

### 3. メインアプリの修正 (`main.py`)

- 管理者メニューに「LINE通知設定」を追加
- ユーザー情報（部屋番号など）を`get_response`関数に渡すように修正

## 使用方法

### LINE Bot設定手順

1. [LINE Developers](https://developers.line.biz/)でアカウントを作成
2. 新しいプロバイダーを作成
3. Messaging APIチャネルを作成
4. チャネルアクセストークン（長期）を発行
5. チャネルシークレットをコピー
6. LINE公式アカウントのQRコードをスキャンして友達追加
7. アプリの「LINE通知設定」でトークン、シークレット、ユーザーIDを設定

### 通知のテスト方法

1. 管理者としてログイン
2. 「LINE通知設定」メニューに移動
3. 必要な設定を入力
4. 「テスト通知を送信」ボタンをクリック
5. LINE公式アカウントからメッセージが届くことを確認

### 実際の動作

- 顧客が質問を入力する際に「お名前・お客様情報など」欄に部屋番号などを入力
- システムが適切な回答を見つけられない場合（類似度0.4未満）に自動的にLINE通知が送信される
- 通知には質問内容、部屋番号、日時などの情報が含まれる

## 注意点

- LINE通知機能を使用するには、有効なLINE Developers APIキーが必要
- テストモードでは実際のLINE通知は送信されない（ログには出力される）
- 類似度のしきい値は管理画面から調整可能（デフォルトは0.4）